---
title: "Data storytelling"
author: "Ricardo Mayer"
date: "08-05-2021"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())

library(tidyverse)
library(lubridate)
library(grid)
library(gridExtra)
library(gridtext)
library(lemon)
library(stringr)

source("include.R")
source("theme/theme_swd.R")


```

## Qué es data storytelling?

**Lecciones narrativas + comunicación de datos efectiva**

+ Lecciones narrativas:
  - Establece tu audiencia
  - Establece tu objetivo
  - Crea un arco narrativo
  - Consigue, concentra y mantiene su atención
  
+ Comunicación de datos
  - Elije el nivel de detalle
  - La forma sigue a la función
  - Elimina lo innecesario
  - Documento para presentar o para circular?
  

## Necesito data storytelling2?

Baja necesidad: análisis exploratorio, archivar datos, traspaso de datos, auditoría

Necesidad media: audiencia cautiva, indicadores rutinarios, audiencia experta, future-proofing

Necesidad alta: capturar atención, inducir una acción, audiencia con poca experiencia, presentar The Big Idea, periodismo de datos 

## Data storytelling en negocios

+ Primera asociación es con periodismo de datos, audiencias masivas (y heterogéneas)

+ Sin embargo es muy útil en contextos de negocios

  - audiencia con tiempo limitado de atención
  
  - audiencia debe escuchar presentaciones que no son de su especialidad
  
  - interacciones dedicadas a la toma de decisiones 
  
 + Énfasis difieren, conjunto de lecciones es similar
  
## Lecciones del data storytelling

  + Facilitar identificación y retención: contexto, conflicto y resolución. Mencionar humanos.
  
  + Facilitar la comprensión: la forma sigue a la función, elegir elemento que sea más fácil de comprender. Anotaciones >> leyendas. 
  
  + Concentrar la atención: eliminar distracciones, inconsistencias y el exceso de información.
  
  + Guiar la atención: mover la atención a las partes que nos interesa que procesen.


## Ejemplo: equipo de atención al cliente

- Equipo de especialistas en Mesa de Ayuda. Reciben y procesan órdenes de trabajo ("tickets")

- En los últimos meses no han podido procesar todos los tickets recibidos. Tuvieron dos renuncias. Antes de eso no había atrasos.

- La gerencia está empezando a notar estos atrasos. Te llaman, como jefe de equipo, a una reunión.

- Tu objetivo: reestablecer la image de tu equipo y conseguir refuerzos.
 
## Primer impulso: mostrar los datos
Tickets de servicio, datos de procesados versus recibidos

```{r tickets-data, include=FALSE, cache=TRUE}
df_t <- read_csv(file.path("data","FIG0410-14.csv")) %>% rename(ticket_type = X1) %>%
  mutate(ticket_type = forcats::fct_rev(factor(case_when(ticket_type == "Ticket Volume Received" ~ "Received",
                                 ticket_type == "Ticket Volume Processed" ~ "Processed")))) %>%
  pivot_longer(cols = !ticket_type, names_to = "month", values_to = "tickets") %>%
  mutate(date = lubridate::ymd(paste0("2000-",match(month,month.abb),"-01"))) %>% 
  mutate(ticket_type_es = ifelse(ticket_type=="Received", "Recibidos",
                                 "Procesados"))

```


```{r tickets-mostrar-los_datos, echo=FALSE, cache=TRUE}

pt_md <- df_t %>% ggplot(aes(x = date, y = tickets, group = ticket_type)) + 
  geom_col(aes(fill = ticket_type), position = "dodge") +  
  geom_text(
    aes(label = tickets),
    vjust = -0.45,
    position = position_dodge(width = 22),
    size = 2
    ) + 
  theme_bw() + 
  theme(legend.position = "bottom")

print(pt_md)
```

## Forma sigue a la función

Si la importa, líneas es mejor que barras.

```{r tickets-lineas-code, echo=FALSE, cache=TRUE}

pt_li <- df_t %>% ggplot(aes(x = date, y = tickets, color = ticket_type)) + 
  geom_line() + 
  geom_point(aes(shape = ticket_type)) + 
  theme_bw() + 
  theme(legend.position = "bottom")

print(pt_li)

```


##  Llama a Marie Kondo, bota cachureos

Remover líneas verticales, horizontales y marcadores de datos

```{r tickets-declutter, echo=FALSE, cache=TRUE}

pt_dc <- df_t %>% ggplot(aes(x = date, y = tickets, color = ticket_type)) + 
  geom_line() + 
  theme_classic() + 
  theme(legend.position = "bottom",
        panel.grid = element_blank())  

print(pt_dc)
  
  

```



## Anotar es mejor que *legendar*

Leyendas suelen distraer y requieren más esfuerzo cognitivo

```{r tickets-annotationoverlegend, echo=FALSE, cache=TRUE}

pt_an <- df_t %>% ggplot(aes(x = date, y = tickets, color = ticket_type)) + 
  geom_line() + 
  theme_classic() + 
  theme(legend.position = "none",
        panel.grid = element_blank()) + 
  annotate(geom = "text", label = "Recibidos", 
           x = as.Date("2000-12-26"), y = 175, size = 4.5)  + 
  annotate(geom = "text", label = "Procesados", 
           x = as.Date("2000-12-28"), y = 135, size = 4.5) +
  coord_cartesian(clip = "off") 

print(pt_an)

```

## El color es una herramienta para la cognición

Colores ya asociados a Recibidos y Procesados. Mantenerlo así.


```{r tickets-colorconsistente, echo=FALSE, cache=TRUE}

pt_cc <- df_t %>% ggplot(aes(x = date, y = tickets, color = ticket_type)) + 
  geom_line() + 
  theme_classic() + 
  theme(legend.position = "none",
        panel.grid = element_blank()) + 
  annotate(geom = "text", label = "Recibidos", color="red",
           x = as.Date("2000-12-26"), y = 175, size = 4.5)  + 
  annotate(geom = "text", label = "Procesados", color="blue",
           x = as.Date("2000-12-28"), y = 135, size = 4.5) +
  coord_cartesian(clip = "off") + 
  scale_color_manual(values = c("Received" = "red",
                                "Processed" = "blue"))

print(pt_cc)

```


## Concentre la atención



```{r tickets-atencion, echo=FALSE, cache=TRUE}
pt_at <-
  ggplot(df_t) + 
  geom_line(aes(x = date, y = tickets, color = ticket_type), size = 2) +
  geom_point(aes(x = date, y = tickets, color = ticket_type),
    size = 4,
    data = df_t %>% filter(date >= ymd("2000-08-01"))
             ) +
  geom_text(aes(x = date, y = tickets, color = ticket_type, 
                label = tickets), nudge_y = 19, size = 4,
            data = df_t %>% filter(date >= ymd("2000-08-01"),
                                   ticket_type == "Received")
            ) +
  geom_text(aes(x = date, y = tickets, color = ticket_type,
                label = tickets), nudge_y = -19, size = 4,
            data = df_t %>% filter(date >= ymd("2000-08-01"), 
                                   ticket_type == "Processed")
            ) +
  geom_text(aes(x = date, y = tickets, color = ticket_type,
                label = ticket_type_es), nudge_x = 5, hjust = 0,
            size = 5, data = df_t %>% filter(month == "Dec")
            ) +
  geom_vline(xintercept = ymd("2000-05-01"), color = GRAY8) +
  scale_x_date(date_labels = "%b",
               date_breaks = "1 month",
               expand = c(0, 0)) +
  scale_y_continuous(breaks = seq(0, 300, 50), limits = c(0, 300)) +
  scale_color_manual(values = c("Received" = GRAY7, "Processed" = BLUE1),
                     guide = NULL) +
  coord_cartesian(clip = "off") +
  labs(
    title = "Volumen de tickets en el tiempo",
    caption = "Fuente: Dashboard de tickets al 12/31/2020 | Se hizo un análisis detallado de tickets por persona\npara sustentar esta petición y está disponible, a petición de los interesados.",
    x = "2020",
    y = "Número de tickets"
  ) + 
  theme_minimal() + 
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.line = element_line(color = GRAY9),
        axis.title.y = element_text(color = GRAY8, hjust = 1),
        axis.title.x = element_text(color = GRAY8, hjust = 0),
        axis.ticks = element_line(color = GRAY9),
        axis.text = element_text(color = GRAY8, size = 12),
        plot.margin = unit(c(1,4,1,1), "cm"),
        plot.title = element_text(size = 18),
        plot.caption = element_text(color = GRAY8,
                                    hjust = 0,                                                               margin = margin(
                                      .3,0,0,0,"cm"))
                  )

print(pt_at)
```



## Entregue un contexto


```{r tickets-after-code, echo=FALSE, cache=TRUE}

grob_explanation <- grobTree(richtext_grob(
  "<span style='background-color:white'><b>2 personas renunciaron en Mayo.</b> Redoblamos esfuerzos, pero el <br>volumen de Agosto dejó una brecha que aún no podemos cerrar</span>", 
  x=0.35,  y=0.95, hjust=0, gp=gpar(col = GRAY3, fontsize=11), box_gp = gpar(col = "white", fill = "white"),
  padding = margin(.4,0,0,0,"in")))

pt_af <-
  ggplot(df_t) + 
  geom_line(aes(x = date, y = tickets, color = ticket_type), size = 2) +
  geom_point(aes(x = date, y = tickets, color = ticket_type),
    size = 4,
    data = df_t %>% filter(date >= ymd("2000-08-01"))
             ) +
  geom_text(aes(x = date, y = tickets, color = ticket_type, 
                label = tickets), nudge_y = 19, size = 4,
            data = df_t %>% filter(date >= ymd("2000-08-01"),
                                   ticket_type == "Received")
            ) +
  geom_text(aes(x = date, y = tickets, color = ticket_type,
                label = tickets), nudge_y = -19, size = 4,
            data = df_t %>% filter(date >= ymd("2000-08-01"), 
                                   ticket_type == "Processed")
            ) +
  geom_text(aes(x = date, y = tickets, color = ticket_type,
                label = ticket_type_es), nudge_x = 5, hjust = 0,
            size = 5, data = df_t %>% filter(month == "Dec")
            ) +
  geom_vline(xintercept = ymd("2000-05-01"), color = GRAY8) +
  scale_x_date(date_labels = "%b",
               date_breaks = "1 month",
               expand = c(0, 0)) +
  scale_y_continuous(breaks = seq(0, 300, 50), limits = c(0, 300)) +
  scale_color_manual(values = c("Received" = GRAY7, "Processed" = BLUE1),
                     guide = NULL) +
  coord_cartesian(clip = "off") +
  labs(
    title = "Volumen de tickets en el tiempo",
    caption = "Fuente: Dashboard de tickets al 12/31/2020 | Se hizo un análisis detallado de tickets por persona\npara sustentar esta petición y está disponible, a petición de los interesados.",
    x = "2020",
    y = "Número de tickets"
  ) +
  annotation_custom(grob_explanation) + 
  theme_minimal() + 
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.line = element_line(color = GRAY9),
        axis.title.y = element_text(color = GRAY8, hjust = 1),
        axis.title.x = element_text(color = GRAY8, hjust = 0),
        axis.ticks = element_line(color = GRAY9),
        axis.text = element_text(color = GRAY8, size = 12),
        plot.margin = unit(c(1,4,1,1), "cm"),
        plot.title = element_text(size = 14),
        plot.caption = element_text(color = GRAY8,
                                    hjust = 0,                                                               margin = margin(
                                      .3,0,0,0,"cm"))
                  )

print(pt_af)

```

## Incluya un llamado a la acción

```{r conpatch, fig.height=5.4, cache=TRUE}
library(patchwork)

pt_af + 
  plot_annotation(
    title = "Por favor aprobar dos nuevos EMAs",
    subtitle = "para recuperar los que se fueron el año pasado",
    theme = theme(plot.title = element_text(size = 20, 
                                            face = "bold"),
                  plot.subtitle = element_text(size = 10,
                                            color = GRAY8)) 
  )
```

